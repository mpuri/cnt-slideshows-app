<!doctype html> 
<html>
<head>
<title>Cond&eacute; Nast Traveler Slideshow Swipe2.js demo</title>
<meta http-equiv="X-UA-Compatible" content="IE=8">
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<link href="swipe.css">
<script src="swipe.js"></script>

<link href="gumby/css/gumby.css">
<script src="gumby/js/libs/modernizr-2.6.2.min.js"></script>
<script src="gumby/js/libs/gumby.min.js" gumby-debug></script>
<script src="gumby/js/libs/ui/gumby.images.js" gumby-debug></script>
<script src="gumby/js/plugins.js"></script>
<script src="gumby/js/main.js"></script>
<script src="underscore.js"></script>
<style>
/* Swipe 2 required styles */
.swipe {
  overflow: hidden;
  visibility: hidden;
  position: relative;
}

.swipe-wrap {
  overflow: hidden;
  position: relative;
}

.swipe-wrap > img {
  float: left;
  width: 100%;
  position: relative;
}

#cntslider,
.image-preview-pane {
  float: left;
}

#previewPaneLeft {
  margin-right: 10px;
}

#previewPaneRight {
  margin-left: 10px;
}
/* END required styles */
</style>
</head>
<body>

<div style='text-align:center; padding-top:20px;'>
  <button onclick='cntslider.prev();'>Prev</button>
  <button onclick='cntslider.next();'>Next</button>
</div>

<section class="slideshow-container row twelve colgrid">
  <canvas id="previewPaneLeft" class="image-preview-pane two columns"></canvas>
  <div id='cntslider' style='max-width: 1000px;' class='swipe eight columns'>
    <div class='swipe-wrap'>
      <img gumby-media="only screen and (max-width: 320px)|images/demo1-320.jpg, only screen and (max-width: 568px)|images/demo1-568.jpg, only screen and (max-width: 768px)|images/demo1-768.jpg, only screen and (min-width: 768px)|images/demo1-1000.jpg" gumby-default="images/demo1.jpg">
      <img gumby-media="only screen and (max-width: 320px)|images/demo2-320.jpg, only screen and (max-width: 568px)|images/demo2-568.jpg, only screen and (max-width: 768px)|images/demo2-768.jpg, only screen and (min-width: 768px)|images/demo2-1000.jpg" gumby-default="images/demo2.jpg">
      <img gumby-media="only screen and (max-width: 320px)|images/demo3-320.jpg, only screen and (max-width: 568px)|images/demo3-568.jpg, only screen and (max-width: 768px)|images/demo3-768.jpg, only screen and (min-width: 768px)|images/demo3-1000.jpg" gumby-default="images/demo3.jpg">
      <img gumby-media="only screen and (max-width: 320px)|images/demo4-320.jpg, only screen and (max-width: 568px)|images/demo4-568.jpg, only screen and (max-width: 768px)|images/demo4-768.jpg, only screen and (min-width: 768px)|images/demo4-1000.jpg" gumby-default="images/demo4.jpg">
    </div>
  </div>
  <canvas id="previewPaneRight" class="image-preview-pane two columns"></canvas>
</section>
<script>
var paneLeft = document.getElementById('previewPaneLeft');
var paneRight = document.getElementById('previewPaneRight');

function slideChange(idx, elem) {
  console.log('Index: ' + idx);
}

function initSwipeJS() {
  window.cntslider = $('#cntslider').Swipe({
    continuous: false,
    callback: slideChange
  }).data('Swipe');
}

function loadPreviewPane(pane, img) {
  var whichPane = (pane === 'left') ? paneLeft : paneRight;
  var context = whichPane.getContext('2d');

  whichPane.width = 100;
  whichPane.height = 750;
  context.globalAlpha = 0.3;
  context.drawImage(img, 0, 0, img.width, img.height);
}

$(document).on('DOMContentLoaded', function () {
  var gumbyLoadedImages = 0,
      slideshowImageLength = $('.swipe-wrap img').length;

  $('.swipe-wrap img').on('gumby.onChange', function(e) {
    gumbyLoadedImages = gumbyLoadedImages + 1;

    if (gumbyLoadedImages === slideshowImageLength) {
      console.log('all images loaded');
      loadPreviewPane('left', $('.swipe-wrap img').get(3));
      loadPreviewPane('right', $('.swipe-wrap img').get(1));
      initSwipeJS();
    }
  }).trigger('gumby.trigger').trigger('gumby.initialize');
});

</script>

</body>
</html>